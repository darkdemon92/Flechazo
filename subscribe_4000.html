<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ElChatCam Stream Monitor - AutoSync</title>
    <style>
        :root {
            --primary: #6366f1;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1e293b;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #0f172a; color: #e2e8f0; min-height: 100vh; }
        
        .header {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0,0,0,0.3);
            padding: 8px 16px;
            border-radius: 20px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--danger);
            animation: none;
        }
        
        .status-dot.connected {
            background: var(--success);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            50% { opacity: 0.8; box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #334155;
            padding-bottom: 10px;
        }
        
        .tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: var(--primary);
            color: white;
        }
        
        .panel { display: none; }
        .panel.active { display: block; }
        
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-box {
            background: #1e293b;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #334155;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
        }
        
        .stat-label { color: #94a3b8; font-size: 0.9rem; margin-top: 5px; }
        
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filters input, .filters select {
            padding: 10px 15px;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            color: white;
            font-size: 0.95rem;
        }
        
        .users-table {
            background: #1e293b;
            border-radius: 12px;
            overflow: hidden;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .user-row {
            display: grid;
            grid-template-columns: 50px 1fr 100px 100px 100px 120px;
            gap: 15px;
            padding: 12px 20px;
            border-bottom: 1px solid #334155;
            align-items: center;
            transition: background 0.2s;
        }
        
        .user-row:hover { background: #334155; }
        
        .user-row.streaming { border-left: 4px solid var(--success); }
        .user-row.private { border-left: 4px solid var(--danger); } /* C√°mara roja */
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .cam-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .cam-green { background: rgba(16, 185, 129, 0.2); color: #4ade80; }
        .cam-red { background: rgba(239, 68, 68, 0.2); color: #f87171; }
        .cam-off { background: rgba(148, 163, 184, 0.2); color: #94a3b8; }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-sm { padding: 5px 10px; font-size: 0.8rem; }
        
        .streams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
        }
        
        .stream-card {
            background: #1e293b;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #334155;
        }
        
        .stream-header {
            padding: 12px 16px;
            background: linear-gradient(135deg, #374151, #1f2937);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stream-badge {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .badge-public { background: var(--success); color: white; }
        .badge-private { background: var(--danger); color: white; }
        
        .stream-container {
            height: 250px;
            background: #0f172a;
            position: relative;
        }
        
        .stream-frame {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .stream-controls {
            padding: 10px;
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        
        .sync-info {
            background: #1e293b;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .last-sync {
            color: #94a3b8;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .user-row { grid-template-columns: 40px 1fr 80px; }
            .user-row > *:nth-child(4), .user-row > *:nth-child(5) { display: none; }
            .streams-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <h1>üì° ElChatCam Monitor</h1>
            <p style="opacity: 0.9; font-size: 0.9rem;">Sincronizaci√≥n autom√°tica con el chat</p>
        </div>
        <div class="connection-status">
            <span class="status-dot" id="statusDot"></span>
            <span id="statusText">Desconectado - Abre el chat en otra pesta√±a</span>
        </div>
    </div>

    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('live')">üî¥ En Vivo</button>
            <button class="tab" onclick="switchTab('all')">üë• Todos los Usuarios</button>
            <button class="tab" onclick="switchTab('streams')">üé• Mis Streams</button>
            <button class="tab" onclick="switchTab('settings')">‚öôÔ∏è Configuraci√≥n</button>
        </div>

        <!-- Panel: En Vivo -->
        <div class="panel active" id="panel-live">
            <div class="sync-info">
                <div class="last-sync">
                    √öltima sincronizaci√≥n: <span id="lastSync">Nunca</span><br>
                    <small style="color: #64748b;">Los datos se actualizan autom√°ticamente desde el chat</small>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-success" onclick="refreshFromChat()">
                        üîÑ Sincronizar Ahora
                    </button>
                    <button class="btn btn-primary" onclick="addAllVisibleToStreams()">
                        ‚ûï Agregar Todos a Streams
                    </button>
                </div>
            </div>

            <div class="stats-bar">
                <div class="stat-box">
                    <div class="stat-value" id="statTotal" style="color: white;">0</div>
                    <div class="stat-label">Total en Chat</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="statStreaming" style="color: var(--success);">0</div>
                    <div class="stat-label">üü¢ Transmitiendo (P√∫blico)</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="statPrivate" style="color: var(--danger);">0</div>
                    <div class="stat-label">üî¥ Privado/Limitado</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="statOffline" style="color: var(--warning);">0</div>
                    <div class="stat-label">‚ö´ Sin C√°mara</div>
                </div>
            </div>

            <div class="filters">
                <input type="text" id="searchLive" placeholder="üîç Buscar usuario..." onkeyup="renderLive()">
                <select id="filterCam" onchange="renderLive()">
                    <option value="all">Todas las c√°maras</option>
                    <option value="green">üü¢ Solo p√∫blicas</option>
                    <option value="red">üî¥ Solo privadas/limitadas</option>
                </select>
                <select id="filterRole" onchange="renderLive()">
                    <option value="all">Todos los roles</option>
                    <option value="admin">üëÆ Admins</option>
                    <option value="vip">‚≠ê VIP</option>
                    <option value="user">üë§ Usuarios</option>
                </select>
            </div>

            <div class="users-table" id="liveTable">
                <div style="padding: 40px; text-align: center; color: #64748b;">
                    <p>Esperando datos del chat...</p>
                    <p style="font-size: 0.9rem; margin-top: 10px;">
                        1. Abre <a href="https://irc.elchatcam.com" target="_blank" style="color: var(--primary);">el chat</a> en otra pesta√±a<br>
                        2. Instala el UserScript de Tampermonkey<br>
                        3. Los datos aparecer√°n autom√°ticamente aqu√≠
                    </p>
                </div>
            </div>
        </div>

        <!-- Panel: Todos los Usuarios -->
        <div class="panel" id="panel-all">
            <div class="stats-bar">
                <div class="stat-box">
                    <div class="stat-value" id="statHistory">0</div>
                    <div class="stat-label">Usuarios vistos (hist√≥rico)</div>
                </div>
            </div>
            
            <div class="users-table" id="historyTable">
                <!-- Hist√≥rico de usuarios -->
            </div>
        </div>

        <!-- Panel: Mis Streams -->
        <div class="panel" id="panel-streams">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Mis Streams Guardados</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-outline" onclick="exportStreams()">üì• Exportar</button>
                    <button class="btn btn-danger" onclick="clearStreams()">üóëÔ∏è Limpiar</button>
                </div>
            </div>
            
            <div class="streams-grid" id="streamsGrid">
                <div style="grid-column: 1/-1; text-align: center; padding: 60px; color: #64748b;">
                    <p>No tienes streams guardados</p>
                    <p style="font-size: 0.9rem;">Ve a "En Vivo" y agrega usuarios</p>
                </div>
            </div>
        </div>

        <!-- Panel: Configuraci√≥n -->
        <div class="panel" id="panel-settings">
            <h2 style="margin-bottom: 20px;">‚öôÔ∏è Configuraci√≥n de Sincronizaci√≥n</h2>
            
            <div style="background: #1e293b; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <h3 style="margin-bottom: 15px; color: var(--primary);">UserScript de Tampermonkey</h3>
                <p style="margin-bottom: 15px; line-height: 1.6;">
                    Para la sincronizaci√≥n autom√°tica, instala este script en Tampermonkey:
                </p>
                
                <div style="background: #0f172a; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.85rem; overflow-x: auto; max-height: 300px; overflow-y: auto;">
                    <pre id="userscriptCode">// El c√≥digo del UserScript va aqu√≠ (ver arriba)</pre>
                </div>
                
                <button class="btn btn-primary" style="margin-top: 15px;" onclick="copyUserScript()">
                    üìã Copiar C√≥digo
                </button>
            </div>

            <div style="background: #1e293b; padding: 20px; border-radius: 12px;">
                <h3 style="margin-bottom: 15px;">Opciones de Actualizaci√≥n</h3>
                
                <div style="display: grid; gap: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <label>Intervalo de sincronizaci√≥n:</label>
                        <select id="syncInterval" onchange="saveSettings()">
                            <option value="5000">5 segundos</option>
                            <option value="10000" selected>10 segundos</option>
                            <option value="30000">30 segundos</option>
                            <option value="60000">1 minuto</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <label>Incluir c√°maras rojas (privadas):</label>
                        <input type="checkbox" id="includeRed" checked onchange="saveSettings()">
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <label>Notificaciones de nuevos streams:</label>
                        <input type="checkbox" id="notifyNew" checked onchange="saveSettings()">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Estado global
        let liveUsers = [];
        let myStreams = JSON.parse(localStorage.getItem('elchatcam_streams') || '[]');
        let settings = JSON.parse(localStorage.getItem('elchatcam_settings') || '{}');
        let lastData = null;
        let checkInterval = null;

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            startSyncCheck();
            renderStreams();
            
            // Verificar cada 3 segundos si hay datos nuevos del UserScript
            checkInterval = setInterval(checkForUpdates, 3000);
        });

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`panel-${tab}`).classList.add('active');
            
            if (tab === 'live') renderLive();
            if (tab === 'all') renderHistory();
            if (tab === 'streams') renderStreams();
        }

        // Verificar actualizaciones del UserScript
        function checkForUpdates() {
            // El UserScript guarda en localStorage del mismo dominio
            // PERO como estamos en file:// o diferente dominio, usamos otra estrategia:
            
            // Estrategia 1: Intentar leer desde el DOM si estamos en el mismo origen
            // (No funciona por CORS)
            
            // Estrategia 2: El usuario debe copiar/pegar manualmente (fallback)
            
            // Estrategia 3: Usar un servidor intermediario (no implementado aqu√≠)
            
            // Por ahora, simulamos la recepci√≥n de datos:
            const mockData = localStorage.getItem('elchatcam_indexer_data');
            if (mockData && mockData !== lastData) {
                lastData = mockData;
                try {
                    const parsed = JSON.parse(mockData);
                    if (parsed.users) {
                        updateLiveData(parsed.users);
                    }
                } catch (e) {
                    console.error('Error parsing data:', e);
                }
            }
            
            // Actualizar estado de conexi√≥n
            const isConnected = mockData && (Date.now() - JSON.parse(mockData).timestamp < 60000);
            updateConnectionStatus(isConnected);
        }

        function updateConnectionStatus(connected) {
            const dot = document.getElementById('statusDot');
            const text = document.getElementById('statusText');
            
            if (connected) {
                dot.classList.add('connected');
                text.textContent = 'Conectado - Sincronizando';
            } else {
                dot.classList.remove('connected');
                text.textContent = 'Desconectado - Abre el chat en otra pesta√±a';
            }
        }

        function updateLiveData(users) {
            liveUsers = users;
            document.getElementById('lastSync').textContent = new Date().toLocaleTimeString();
            
            // Actualizar stats
            const streaming = users.filter(u => u.isStreaming);
            const green = users.filter(u => u.camStatus === 'green');
            const red = users.filter(u => u.camStatus === 'red');
            const offline = users.filter(u => u.camStatus === 'none');
            
            document.getElementById('statTotal').textContent = users.length;
            document.getElementById('statStreaming').textContent = green.length;
            document.getElementById('statPrivate').textContent = red.length;
            document.getElementById('statOffline').textContent = offline.length;
            
            renderLive();
            
            // Notificar nuevos streams si est√° habilitado
            if (settings.notifyNew) {
                const newStreams = streaming.filter(s => !liveUsers.find(u => u.name === s.name && u.lastSeen));
                if (newStreams.length > 0) {
                    showNotification(`${newStreams.length} nuevos streams detectados`);
                }
            }
        }

        function renderLive() {
            const container = document.getElementById('liveTable');
            const search = document.getElementById('searchLive')?.value.toLowerCase() || '';
            const camFilter = document.getElementById('filterCam')?.value || 'all';
            const roleFilter = document.getElementById('filterRole')?.value || 'all';
            
            let filtered = liveUsers.filter(u => {
                if (search && !u.name.toLowerCase().includes(search)) return false;
                if (camFilter === 'green' && u.camStatus !== 'green') return false;
                if (camFilter === 'red' && u.camStatus !== 'red') return false;
                if (roleFilter !== 'all' && u.role !== roleFilter) return false;
                return true;
            });

            // Ordenar: transmitiendo primero, luego por nombre
            filtered.sort((a, b) => {
                if (a.isStreaming && !b.isStreaming) return -1;
                if (!a.isStreaming && b.isStreaming) return 1;
                return a.name.localeCompare(b.name);
            });

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div style="padding: 40px; text-align: center; color: #64748b;">
                        <p>No hay usuarios que coincidan con los filtros</p>
                    </div>`;
                return;
            }

            container.innerHTML = `
                <div class="user-row" style="background: #334155; font-weight: 600;">
                    <div></div>
                    <div>Usuario</div>
                    <div>C√°mara</div>
                    <div>Rol</div>
                    <div>Espect.</div>
                    <div>Acciones</div>
                </div>
                ${filtered.map(user => `
                    <div class="user-row ${user.isStreaming ? 'streaming' : ''} ${user.isPrivate ? 'private' : ''}">
                        <img src="${user.avatar}" class="user-avatar" onerror="this.src='/uploads/avatars/default.png'">
                        <div>
                            <div style="font-weight: 600;">${escapeHtml(user.name)}</div>
                            <div style="font-size: 0.75rem; color: #64748b;">
                                ${user.firstSeen ? 'Visto desde: ' + new Date(user.firstSeen).toLocaleDateString() : ''}
                            </div>
                        </div>
                        <div>
                            <span class="cam-indicator cam-${user.camStatus}">
                                ${user.camStatus === 'green' ? 'üü¢ P√∫blica' : 
                                  user.camStatus === 'red' ? 'üî¥ Privada' : '‚ö´ Off'}
                            </span>
                        </div>
                        <div>
                            <span style="text-transform: uppercase; font-size: 0.75rem; padding: 2px 8px; border-radius: 4px; background: ${user.role === 'admin' ? '#fee2e2' : user.role === 'vip' ? '#fef3c7' : '#e0e7ff'}; color: ${user.role === 'admin' ? '#991b1b' : user.role === 'vip' ? '#92400e' : '#3730a3'};">
                                ${user.role}
                            </span>
                        </div>
                        <div style="text-align: center; font-weight: 600;">
                            ${user.viewers || 0}
                        </div>
                        <div>
                            ${user.isStreaming ? `
                                <button class="btn btn-success btn-sm" onclick="addToStreams('${user.name}', '${user.url}', '${user.avatar}', ${user.isPrivate})">
                                    ‚ûï Agregar
                                </button>
                            ` : '<span style="color: #64748b; font-size: 0.8rem;">No transmite</span>'}
                        </div>
                    </div>
                `).join('')}`;
        }

        function addToStreams(name, url, avatar, isPrivate) {
            if (myStreams.find(s => s.name === name)) {
                showNotification(`${name} ya est√° en tus streams`);
                return;
            }
            
            myStreams.push({
                id: Date.now() + Math.random(),
                name: name,
                url: url,
                avatar: avatar,
                isPrivate: isPrivate,
                addedAt: new Date().toISOString()
            });
            
            localStorage.setItem('elchatcam_streams', JSON.stringify(myStreams));
            showNotification(`${name} agregado a streams`);
        }

        function addAllVisibleToStreams() {
            const visible = getFilteredLive();
            let added = 0;
            
            visible.filter(u => u.isStreaming).forEach(user => {
                if (!myStreams.find(s => s.name === user.name)) {
                    addToStreams(user.name, user.url, user.avatar, user.isPrivate);
                    added++;
                }
            });
            
            showNotification(`${added} streams agregados`);
        }

        function getFilteredLive() {
            const search = document.getElementById('searchLive')?.value.toLowerCase() || '';
            const camFilter = document.getElementById('filterCam')?.value || 'all';
            const roleFilter = document.getElementById('filterRole')?.value || 'all';
            
            return liveUsers.filter(u => {
                if (search && !u.name.toLowerCase().includes(search)) return false;
                if (camFilter === 'green' && u.camStatus !== 'green') return false;
                if (camFilter === 'red' && u.camStatus !== 'red') return false;
                if (roleFilter !== 'all' && u.role !== roleFilter) return false;
                return true;
            });
        }

        function renderStreams() {
            const container = document.getElementById('streamsGrid');
            
            if (myStreams.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 60px; color: #64748b;">
                        <p>No tienes streams guardados</p>
                    </div>`;
                return;
            }

            container.innerHTML = myStreams.map(stream => `
                <div class="stream-card">
                    <div class="stream-header">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="${stream.avatar}" style="width: 30px; height: 30px; border-radius: 50%;">
                            <span style="font-weight: 600;">${escapeHtml(stream.name)}</span>
                            ${stream.isPrivate ? '<span class="stream-badge badge-private">üî¥ PRIVADO</span>' : '<span class="stream-badge badge-public">üü¢ P√öBLICO</span>'}
                        </div>
                        <button onclick="removeStream('${stream.id}')" style="background: none; border: none; color: white; cursor: pointer;">‚úï</button>
                    </div>
                    <div class="stream-container">
                        <iframe class="stream-frame" src="${stream.url}" frameborder="0" allowfullscreen></iframe>
                    </div>
                    <div class="stream-controls">
                        <button class="btn btn-primary btn-sm" onclick="reloadStream('${stream.id}')">üîÑ Recargar</button>
                        <a href="${stream.url}" target="_blank" class="btn btn-success btn-sm" style="text-decoration: none;">üîó Abrir</a>
                        <button class="btn btn-danger btn-sm" onclick="removeStream('${stream.id}')">üóëÔ∏è Eliminar</button>
                    </div>
                </div>
            `).join('');
        }

        function reloadStream(id) {
            const card = document.querySelector(`[onclick="removeStream('${id}')"]`)?.closest('.stream-card');
            if (!card) return;
            const iframe = card.querySelector('iframe');
            const src = iframe.src;
            iframe.src = '';
            setTimeout(() => iframe.src = src, 100);
        }

        function removeStream(id) {
            myStreams = myStreams.filter(s => s.id != id);
            localStorage.setItem('elchatcam_streams', JSON.stringify(myStreams));
            renderStreams();
        }

        function clearStreams() {
            if (!confirm('¬øEliminar todos los streams?')) return;
            myStreams = [];
            localStorage.setItem('elchatcam_streams', '[]');
            renderStreams();
        }

        function exportStreams() {
            const data = {
                streams: myStreams,
                exportedAt: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `elchatcam-streams-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        }

        function refreshFromChat() {
            // Simulaci√≥n: en realidad esto esperar√≠a al UserScript
            showNotification('Solicitando actualizaci√≥n...');
            checkForUpdates();
        }

        function saveSettings() {
            settings = {
                syncInterval: document.getElementById('syncInterval').value,
                includeRed: document.getElementById('includeRed').checked,
                notifyNew: document.getElementById('notifyNew').checked
            };
            localStorage.setItem('elchatcam_settings', JSON.stringify(settings));
        }

        function loadSettings() {
            if (settings.syncInterval) document.getElementById('syncInterval').value = settings.syncInterval;
            if (settings.includeRed !== undefined) document.getElementById('includeRed').checked = settings.includeRed;
            if (settings.notifyNew !== undefined) document.getElementById('notifyNew').checked = settings.notifyNew;
        }

        function copyUserScript() {
            const code = document.getElementById('userscriptCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                showNotification('UserScript copiado al portapapeles');
            });
        }

        function showNotification(message) {
            const notif = document.createElement('div');
            notif.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: var(--success);
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10000;
                font-weight: 600;
                animation: slideIn 0.3s ease;
            `;
            notif.textContent = message;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 3000);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function startSyncCheck() {
            // Intentar conectar con el UserScript
            setInterval(() => {
                // En una implementaci√≥n real, aqu√≠ habr√≠a WebSocket o BroadcastChannel
                checkForUpdates();
            }, 3000);
        }

        function renderHistory() {
            // Implementar si se necesita hist√≥rico
            document.getElementById('historyTable').innerHTML = '<div style="padding: 40px; text-align: center;">Funci√≥n en desarrollo</div>';
        }
    </script>
</body>
</html>
